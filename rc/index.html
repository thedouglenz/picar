<!-- Client side app for raspberry pi remote controlled car -->
<!-- Douglas Lenz, 2015 -->
<!doctype html>
<html>
    <head>
	<title> Raspberry Pi Remote Control Car Controller </title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/> <!--320-->
	<link rel="stylesheet" href="vendor/pure-release-0.5.0/pure-min-css">
	<style> <!-- TODO: Move these styles to an external file; Style the user page some more-->
	    #output-area ul {
		list-style-type: none;
	    }
	    #output-area li {
		font: 22px Helvetica, Arial;
		color: #313131;
	    }
	    p a {
		text-decoration: none;
		color: #000;
	    }
	</style>
    </head>

    <body>
	<div class="pure-g">
	    <div class="pure-u-1">
		<h2> Rpi RC Car Controller </h2>
	    </div>
	    <div id="output-area" class="pure-u-1">
		<ul>
		    <li id="show-beta"></li>
		    <li id="show-gamm"></li>
		</ul>
	    </div>
	</div>
	<script src="vendor/jquery-2.1.3.min.js" language="javascript"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">
	    var alpha = 0;
	    var beta = 0;
	    var gamma  = 0;
	    var ready;
	    var li_beta = $("#show-beta");
	    var li_gamma = $("#show-gamm");

	    var socket = io.connect(window.location.hostname + ':3000');

	    var orient = function(event) {
		// Don't need alpha
		// alpha = event.alpha; // motion of device around z-axis (0, 360)
		betat = event.beta; // motion of device around x-axis (-180, 180)
		gammat = event.gamma; // motion of device around y-axis (-90, 90)

		if(gammat > 45) {
		    gammat = -90;
		} else if (gammat > 0) {
		    gammat = 0;
		}

		gamma = 0.01 * ( 90 - (-1 * gammat) );
		beta = betat;

		li_beta.html("y: " + beta);
		li_gamma.html("z: " + gamma);	
	    };

	    var update = function() {
		if(ready) {
		    ready = false;
		    socket.emit('update', { beta: beta, gamma: gamma });
		    console.log("Sent: " + { beta: beta, gamma: gamma }); 
		    ready = true;
		}
	    }

	    $(document).ready(function() {
		$("#output-area").append($("<p>").html("<a href='https://twitter.com/douglnz'>@douglnz</a>"));
		ready = true;
		window.addEventListener('deviceorientation', orient, true);
		nextInterval = setInterval(update, 50);
	    });
	</script>
    </body>

</html>

